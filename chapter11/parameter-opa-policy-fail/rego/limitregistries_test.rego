package k8sallowedregistries


test_cronjob_registry_allowed_multicontainer {
    invalidRegistry with input as {"apiVersion":"admission.k8s.io/v1","kind":"AdmissionReview","parameters":{"registries":["x","quay.io/"]},"review":{"uid":"705ab4f5-6393-11e8-b7cc-42010a800002","kind":{"group":"autoscaling","version":"v1","kind":"Scale"},"resource":{"group":"apps","version":"v1","resource":"deployments"},"subResource":"scale","requestKind":{"group":"autoscaling","version":"v1","kind":"Scale"},"requestResource":{"group":"apps","version":"v1","resource":"deployments"},"requestSubResource":"scale","name":"my-deployment","namespace":"my-namespace","operation":"CREATE","userInfo":{"username":"admin","uid":"014fbff9a07c","groups":["system:authenticated","my-admin-group"],"extra":{"some-key":["some-value1","some-value2"]}},"object":{"apiVersion":"batch/v1beta1","kind":"CronJob","metadata":{"creationTimestamp":"2020-07-04T17:21:04Z","labels":{"app":"openunison-orchestra","operated-by":"openunison-operator"},"name":"check-certs-orchestra","namespace":"openunison","resourceVersion":"91900","selfLink":"/apis/batch/v1beta1/namespaces/openunison/cronjobs/check-certs-orchestra","uid":"a1bbec0b-d7ec-4272-bddf-0b9497c4559f"},"spec":{"concurrencyPolicy":"Allow","failedJobsHistoryLimit":1,"jobTemplate":{"metadata":{"creationTimestamp":null},"spec":{"backoffLimit":1,"template":{"metadata":{"creationTimestamp":null},"spec":{"containers":[{"command":["java","-jar","/usr/local/artifactdeploy/artifact-deploy.jar","-extraCertsPath","/etc/extracerts","-installScriptURL","file:///etc/input-maps/cert-check.js","-kubernetesURL","https://kubernetes.default.svc.cluster.local","-rootCaPath","/var/run/secrets/kubernetes.io/serviceaccount/ca.crt","-secretsPath","/etc/input-maps/input.props","-tokenPath","/var/run/secrets/kubernetes.io/serviceaccount/token","-deploymentTemplate","file:///etc/input-maps/deployment.yaml"],"env":[{"name":"CERT_DAYS_EXPIRE","value":"10"}],"image":"quay.io/tremolosecurity/kubernetes-artifact-deployment:1.1.0","imagePullPolicy":"IfNotPresent","name":"check-certs-orchestra","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/etc/extracerts","name":"extra-certs-dir","readOnly":true},{"mountPath":"/etc/input-maps","name":"input-maps","readOnly":true}]},{"command":["java","-jar","/usr/local/artifactdeploy/artifact-deploy.jar","-extraCertsPath","/etc/extracerts","-installScriptURL","file:///etc/input-maps/cert-check.js","-kubernetesURL","https://kubernetes.default.svc.cluster.local","-rootCaPath","/var/run/secrets/kubernetes.io/serviceaccount/ca.crt","-secretsPath","/etc/input-maps/input.props","-tokenPath","/var/run/secrets/kubernetes.io/serviceaccount/token","-deploymentTemplate","file:///etc/input-maps/deployment.yaml"],"env":[{"name":"CERT_DAYS_EXPIRE","value":"10"}],"image":"x/tremolosecurity/kubernetes-artifact-deployment:1.1.0","imagePullPolicy":"IfNotPresent","name":"check-certs-orchestra","resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/etc/extracerts","name":"extra-certs-dir","readOnly":true},{"mountPath":"/etc/input-maps","name":"input-maps","readOnly":true}]}],"dnsPolicy":"ClusterFirst","restartPolicy":"Never","schedulerName":"default-scheduler","securityContext":{},"serviceAccount":"openunison-operator","serviceAccountName":"openunison-operator","terminationGracePeriodSeconds":30,"volumes":[{"configMap":{"defaultMode":420,"name":"cert-controller-js-orchestra"},"name":"extra-certs-dir"},{"configMap":{"defaultMode":420,"name":"cert-controller-js-orchestra"},"name":"input-maps"}]}}}},"schedule":"0 2 * * *","successfulJobsHistoryLimit":3,"suspend":false},"status":{"lastScheduleTime":"2020-07-05T02:00:00Z"}},"oldObject":null,"options":null,"dryRun":false}}
}

