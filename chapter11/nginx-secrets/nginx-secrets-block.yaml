apiVersion: security.kubearmor.com/v1
kind: KubeArmorPolicy
metadata:
  name: nginx-secret
  namespace: my-ext-secret
spec:
  selector:
    matchLabels:
      app: nginx-secrets
  file:
    matchDirectories:
    - dir: /
      recursive: true
    - dir: /src/
      recursive: true
      fromSource:
        - path: /usr/local/bin/python3
        - path: /usr/local/bin/python3.11
        #       - path: /usr/local/lib/python3.11/site-packages/flask/app.py
    - dir: /etc/secrets/
      recursive: true
      fromSource:
        - path: /usr/local/bin/python3.11
        - path: /usr/local/bin/python3
        #- path: /usr/local/lib/python3.11/site-packages/flask/app.py
    - dir: /etc/nginx/
      recursive: true
      action: Block
    - dir: /etc/secrets/
      recursive: true
      action: Block
  process:
    matchPaths:
    - path: /usr/local/bin/python3
    - path: /usr/bin/bash
  action:
    Allow

