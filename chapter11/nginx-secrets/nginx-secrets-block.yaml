apiVersion: security.kubearmor.com/v1
kind: KubeArmorPolicy
metadata:
  name: only-allow-nginx-exec
  namespace: my-ext-secret
spec:
  selector:
    matchLabels:
      app: nginx-web
  file:
    matchDirectories:
    - dir: /
      recursive: true
    - dir: /etc/secrets/
      recursive: true
      fromSource:
        - path: /usr/sbin/nginx
    - dir: /etc/nginx/
      recursive: true
      fromSource:
        - path: /usr/sbin/nginx
    - dir: /etc/nginx/
      recursive: true
      action: Block
    - dir: /etc/secrets/
      recursive: true
      action: Block
  process:
    matchPaths:
    - path: /usr/sbin/nginx
    - path: /usr/bin/ls
  action:
    Allow
